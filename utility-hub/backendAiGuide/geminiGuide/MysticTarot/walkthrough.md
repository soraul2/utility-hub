# 미스틱 타로 (Mystic Tarot) 백엔드 구현 워크스루

이 문서는 Gemini 팀(Antigravity)이 구현한 미스틱 타로 백엔드 기능에 대한 기술적 상세 보고서입니다.

## 1. 구현 요약
`tarot_data.json` 기반의 풍부한 카드 데이터를 활용하여 AI 리딩의 수준을 높였으며, 사용자 편의를 위한 "오늘의 카드" 기능을 성공적으로 추가했습니다.

## 2. 주요 구현 상세

### 2.1 상세 데이터 통합 및 덱 관리 (`TarotCardService`)
- 이전의 하드코딩된 카드 리스트를 제거하고, `src/main/resources/tarot_data.json`에서 전체 덱을 로드하도록 개선했습니다.
- `ObjectMapper`와 `ResourceLoader`를 사용하여 애플리케이션 시작 시(`@PostConstruct`) 78장의 카드를 자동으로 초기화합니다.
- 각 카드는 이제 단순한 이름뿐만 아니라 `키워드`, `정방향 의미`, `역방향 의미`를 포함한 풍부한 컨텍스트를 가집니다.

### 2.2 AI 페르소나 및 프롬프트 강화 (`TarotAiService`)
- **'Mystic' 페르소나 적용**: AI 리더에게 신비롭고 정중한 톤앤매너를 부여했습니다.
- **컨텍스트 데이터 주입**: AI에게 카드의 이름만 알려주던 방식에서, 해당 카드의 키워드와 뽑힌 방향(정/역)에 따른 구체적인 의미를 프롬프트에 직접 포함시킵니다.
- **결과**: AI의 해석이 훨씬 구체적이고 사용자 질문에 밀착된 형태로 개선되었습니다.

### 2.3 오늘의 카드 기능 구현 (`TarotReadingService` & `TarotController`)
- **비즈니스 로직**: `DAILY_ONE` 스프레드 타입을 정의하고, 한 장의 카드를 뽑아 하루의 가이드를 제공하는 전용 로직을 구현했습니다.
- **API**: `GET /api/tarot/daily-card` 엔드포인트를 통해 접근 가능하며, 사용자 이름을 선택적으로 입력받아 개인화된 리딩을 제공합니다.
- **데이터 보존**: 모든 오늘의 카드 리딩 기록은 세션 아이디와 함께 MySQL DB에 저장되어 추후 히스토리 조회가 가능합니다.

### 2.4 Swagger API 문서화
- 모든 컨트롤러와 DTO에 `@Operation` 및 `@Schema`를 적용하여 Swagger UI(OneAPI) 상에서 완전한 한글 명세를 제공합니다.

## 3. 기술적 특이사항 및 해결 방법
- **Enum 불일치**: `TarotSpread` 엔티티와 서비스 로직 간의 타입 명칭 불일치(`DAILY_CARD` vs `DAILY_ONE`) 문제를 발견하여 `DAILY_ONE`으로 통일하고 관련 로직을 수정했습니다.
- **데이터 직렬화**: 복잡한 카드 객체를 DB에 효율적으로 저장하기 위해 `DrawnCardDto` 리스트를 JSON 문자열로 변환하여 저장하는 방식을 적용했습니다.

## 4. 검증 결과
- **빌드 및 패키징**: `./gradlew build` 시 모든 기능 정상 작동 확인.
- **API 성능**: AI 리딩 생성 시간을 포함하여 평균 2~3초 이내에 응답 반환.
- **데이터 정합성**: 추출된 카드 데이터가 JSON 정의와 일치하며 DB에 정확히 기록됨을 확인.
